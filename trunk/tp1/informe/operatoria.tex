\chapter{Operatoria de la cocina:}

\section{Ingreso de pedidos}
Los pedidos basicamente pueden ser remotos o locales. Los pedidos remotos se pueden realizar via telefonica, via web, o via sms. Un pedido local se realiza siempre a un mozo.

\subsection{Pedidos remotos}
Los pedidos remotos requieren que los usuarios esten registrados en el sistema. Esto se hace por cuestiones de seguridad, a fin de evitar la realización de pedidos por parte de usuarios anonimos que podrian cancelar constantemente. La registracion de usuarios se realiza personalmente o telefonicamente. Decidimos no permitir regitro de usuarios via web, ya que consideramos que el método no era del todo fiable (es facil crear usuarios ficticios y hacer pedidos en broma).

Un usuario registrado obtiene un nombre de usuario con el cual puede autentificarse en el sistema. En particular para poder hacer pedidos SMS, un usuario debe en el momento del registro brindar el número del télefono celular desde el cual va a realizar los pedidos.

A continuación describiremos los procedimientos para la realización de pedidos remotos.

\subsubsection{Pedidos telefonicos}
El cliente que desee realizar un pedido telefonico debe llamar al número de la pizzería. El encargado de pedidos es el responsable de atender los llamados telefonicos. El cliente debe brindar sus datos de usuario para poder realizar un pedido. El encargado de pedidos ingresa esos datos y el sistema se encarga de chequear la validez de los mismos.

Si el usuario no estaba registrado, el encargado debe sugerirle la posibilidad de registrarse. Si el usuario no esta registrado y no desea registrarse, no se toma el pedido. %TODO: caso de uso chequear datos de usuario

Una vez autentificado el usuario, el mismo procede a dictar su pedido al encargado de pedidos. Una vez finalizado, el encargado de pedidos intenta ingresar el pedido al sistema, el cual se encarga de verificar si es posible satisfacer dicho pedido. En caso de no ser posible el sistema indicara mediante un mensaje de error que el pedido no fue posible de realizar e indicara que producto/s no estaba/n disponible/s. El cliente puede entonces dar un pedido diferente.

Si el pedido sí podía ser tomado, el sistema se encarga de registrar el pedido como ingresado. Se genera un identificador de pedido, se estima el tiempo del mismo y se calcula el costo total. Ademas si el pedido es mixto se brinda la posibilidad de que el encargado de pedidos asigne un horno o de que esta asignación sea automatica. %TODO: caso de uso loco

%TODO: poner diagrama de actividad
%NOTA: estos casos de uso q aparecen son medio especificos del caso, tonces se podria hacer un diagrama aparte

\subsubsection{Pedidos web}
Para que los clientes puedan realizar pedidos via web, la pizzería contara con una página web. El cliente que desee hacer un pedido por esta vía debe ingresar a la página y autentificarse.

Una vez autentificado, tendra la posibilidad de elegir ingresar pedido. Entonces podra elegir que productos desea y con que cantidad. Cuando marco lo que deseaba puede ingresar el pedido. Entonces el sistema verifica la viabilidad del pedido, y en caso de no ser posible de realizar lo informa mediante un mensaje indicando que producto no se encuentra disponible. El cliente puede volver a ingresar un pedido.

En caso de que sea posible registrar el pedido, se genera un identificador de pedido, se estima el tiempo del mismo y se calcula el costo total. Esta información se muestra al usuario por pantalla. Luego se brinda la posibilidad de realizar un pago con tarjeta o en efectivo al delivery. Si el usuario decide pagar con tarjeta debera ingresar los datos de la misma y el sistema se encargara de efectuar el cobro interactuando con el sistema bancario. Si el cobro no se pudo realizar, el usuario podra reingresar los datos de la tarjeta o decidir pagar el pedido en efectivo.

En este caso la asignación del horno en caso de que un pedido sea mixto es responsabilidad del sistema.

\subsubsection{Pedidos SMS}
El cliente que desee realizar un pedido via sms debe enviar un mensaje al servidor sms de la pizzeria, junto con el pedido que quiere hacer. Si el celular no estaba registrado, el sistema descarta el pedido y le envia un mensaje sms al mismo sugiriendole registrarse por telefono o personalmente.

El sistema verifica si es posible satisfacer el pedido. En caso de no ser posible el sistema le envia un mensaje al cliente para avisar que el pedido no podra ser satisfecho. Si el pedido sí podía ser tomado, el sistema lo registra como ingresado, genera un identificador de pedido (para despues hacer reclamos o consultas), estima el tiempo del mismo (desde que se registra el pedido hasta que llega a su casa, teniendo en cuenta el tiempo de demora del delivery), calcula el costo total y luego de todo esto procede a enviarle un mensaje de respuesta de sms con esos datos al cliente.

\subsection{Pedidos locales}
Como dijimos previamente, los pedidos locales se realizan a los mozos, quienes cuentan con una PDA para realizar el registro de los pedidos. Un cliente dicta su pedido a algún mozo, el cual marca los productos y sus cantidades en su PDA. una vez que el cliente dictó su pedido el mozo ingresa el pedido. El sistema verifica la factibilidad del mismo, si no es posible tomarlo, notifica al mozo para que informe de la situación al cliente.

Si es posible ingresar el pedido el sistema genera el id del pedido, se estima el tiempo del mismo y se calcula el costo total. La asignación del horno es también responsabilidad del sistema.

\section{Registro de usuarios}
El registro de usuarios es responsabilidad del encargado de pedidos, y se realiza por via telefonica asi como también personalmente. 

Para registrar a un usuario el encargado de pedidos debe tomar los siguientes datos:
\begin{itemize}
\item Nombre
\item Apellido
\item Dirección
\item Telefono
\item Célular (opcional, solo necesario para poder hacer pedidos vis SMS)
\end{itemize}

\section{Facturacion}
La facturación de los pedidos de la pizzería esta a cargo del software de facturación que posee el establecimiento. El sistema solo provee de la facilidad de generar un archivo con los datos necesarios para realizar la factura cuando el cajero lo determine adecuado. El sistema no puede saber cuando se facturó un archivo de forma automatica, dicho evento debe ser informado por el cajero. %TODO: caso de uso no?
Lo unico que registra el sistema por si solo es que ya se ha generado un archivo para facturar el pedido.
%FIXME: q onda con los pedidos en el local q no tienen todos los datos

A la hora de generar el archivo la forma de pago de los pedidos en el local debe ser ingresada por el mozo, tras preguntarsela al cliente. En el caso de los pedidos via SMS o telefonicos, estos se pagan en efectivo al delivery. Por otro lado, para los pedidos via web, la forma de pago la determina el usuario. En esta caso, si el pago es mediante tarjeta el sistema registra que el pedido ya esta pago antes de entregar.

\section{Cancelación}
La cancelación de un pedido se realiza via telefonica o personalmente. Una cancelación se puede realizar siempre y cuando no se haya generado la factura para el pedido. %TODO: revisar esto, porq si la facturacion es manual se chinga, tal vez alcance con que no se genere el archivo

Los productos ya elaborados, se descartan al cancelarse el pedido. En cambio los insumos no utilizados regresan al stock automaticamente, de esto se encarga el sistema de manera automatica.

Para cancelar un pedido via telefonica el usuario debe identificarse, y luego debe indicar el número del pedido que pretende cancelar. En caso de un pedido hecho en el local, el cliente debe avisar al mozo, que notifica al encargado de pedidos, quien cancela el pedido a partir del número del mismo.

\section{Cola de pedidos}
Por cola de pedidos se entiende la cola que determina el orden en el cual se prepararan los pedidos ingresados al sistema. La cola es la que determina que pedido ingresado debe comenzar a preparse a continuación. Dicha cola se gestiona de manera automatica, pero puede ser modificada por el encargado de pedidos. Ni bien un producto pasa a preparse, es decir se comienza a preparar cualquiera de sus partes el mismo deja de estar en esta cola.

Cuando el maestro esta listo para preparar algun producto, debe indicarselo al sistema, el cual le muestra que debe preparar a continuación. La finalización de la preparación de un producto es indicada implicitamente por el maestro al pedir el proximo producto a preparar.

Cuando todas las partes de un pedido fueron preparados, el pedido deja de estar en preparación para pasar a estar en estado de preparado.

\section{Cola de horno} 
La cola del horno es la cola que establece que pedido (que parte del mismo) se cocinara a continuación. La cola se gestiona también de manera automatica. El maestro pide al sistema que pedido debe cocinar a continuación. El sistema informa que parte del mismo debe colocar al horno. A partir de este momento, el pedido pasa a ser considerado al horno. El sistema identifica que parte esta realmente en el horno, que parte aun no ingreso y que parte ya fue cocinada. Cuando todas las partes del pedido fueron cocinadas, se considera que el pedido fue cocinado. Cuando el maestro saca algo del horno, debe indicarselo al sistema a fin de que este pueda establecer que poner a continuación. 

La cola ingreso al horno admite varias politicas, una de ella es la de sectores agiles. En este caso, algunos modulos funcionan como modulos agiles y dan prioridad a los pedidos mas chicos. Es decir, que cuando se libera un modulo agil y el maestro pide que producto debe ingrear, el sistema tendra en cuenta la existencia de pedidos mas chicos que se puedan ingresar por completo al horno. 

El cambio de politica es ingresado por el encargado de pedidos, quien al cambiar la politica a sectores agiles, debe ingresar cuales son los modulos agiles. El sistema necesita ademas conocer el tamaño de los modulos de los hornos.

%FIXME: esto esta dudoso, no logro entender si puede ingresar un pedido antes de que el actual ingrese completo, es decir si solo puede haber un pedido mitad adentro, mitad afuera. Para explicar esto hay q consultar, pero la idea es mas o menos la misma en cuanto a interacciones'